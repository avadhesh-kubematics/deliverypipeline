language: scala

scala:
   - 2.11.4

build_image: shippableimages/ubuntu1404_scala:0.0.1

before_install:
  - pip install awsebcli
  - sudo apt-get update
  - sudo apt-get install docker.io -y

before_script:
  - mkdir -p ~/.aws
  - echo '[profile eb-cli]' > ~/.aws/config
  - echo "aws_access_key_id = $AWSAccessKeyId" >> ~/.aws/config
  - echo "aws_secret_access_key = $AWSSecretKey" >> ~/.aws/config
  - export SBT_OPTS="-XX:+CMSClassUnloadingEnabled -XX:PermSize=256M -XX:MaxPermSize=512M"
  - export DOCKER_HOST="tcp://0.0.0.0:2375"
  - export DOCKER_CERT_PATH=./cert
  - export DOCKER_TLS_VERIFY=1
  - sudo docker -d -H unix:///var/run/docker.sock -H tcp://0.0.0.0:2375
  - ls -l /var/run/docker.sock
  - sudo docker version
  - sudo docker info
  - docker login --username="$DOCKER_USERNAME" --password="$DOCKER_PASSWORD" --email="$DOCKER_EMAIL"

script:
 - sbt clean dockerBuildAndPush

after_success :
  - eb init deliverypipeline -r eu-west-1  -p docker
  - eb deploy

notifications:
 email:
   recipients:
   - krisztian.lachata@gmail.com

env:
  global:
  - secure: gLYa8QgIEu5XmxxfhjuYspCOC+blbvsUEqZQip+KIL/lH6genpIFnCu/tOQzkBh5V+peZLHKNemT9CKteo9zycYfdwn2mp1HdrrnFhjnSCrIf0/gnTYICeZWKfV9Bj19D4hYXsyxZlS4xkQg4owI0vT7G/oggAbliEdmQ+WaJO2/Q3YG4ICfge6xwmlQgQxSxgEwpn2+u9cz1QA+xcq67wwGEypV0bqxAiYGTkjDuzN4JFEnO0K81657qo8lAUKVjK+j/O2eHYMu32lJIfyfXjvpM2Dk1QFGS70UrTK/d7mwnSE+zjGtvQseW00aNBmOxKH2Vq56y1XZKaW9J7tPbw==
  - secure: TlSKCge6xvf4M5a1Kbxw7yX3R8WJvVYdaprJDzeYEnKc0LtKM/XEon6cZlRMtIJiBb+KRmT9oxLg7fawf0mXGpj7aRm80YeOhj0tGAnofkmjZWwzvmAi5kGJQ7Irz5oAGeVJTggFlCQN8tH/xeELIADL+3naGy2s7aQzB+Y15jzdFj32x1ek0J9g91TcsOmaVv3/IhQrLqvNE5+gxx6r8tnknf8rFHksooNMcbuxR11P45BPFW9Q1MStjcaT05b6VEa5ZEp8WT8HF50FcrLM0b7vw1E+nIjr6nkJUpYaxrYHel4bWnYGpv65mBg7xBTFTYeJy9S2d6G1+xuC+pfftg==