box: wercker-labs/docker
build:
    steps:
        - script:
            name: Prepare
            code: |-
                # Upgrade Ubuntu
                sudo apt-get update
                sudo apt-get install -y update-manager-core
                sudo do-release-upgrade -f DistUpgradeViewNonInteractive -m server -d
                sudo apt-get install -y aptitude
                sudo aptitude update
                sudo aptitude safe-upgrade
                
                # Install Java7
                sudo apt-get update
                sudo apt-get install -y build-essential
                sudo apt-get install -y software-properties-common
                sudo apt-get install python-software-properties git-core curl wget -y
                sudo add-apt-repository ppa:webupd8team/java -y
                sudo apt-get update
                echo debconf shared/accepted-oracle-license-v1-1 select true | sudo debconf-set-selections
                echo debconf shared/accepted-oracle-license-v1-1 seen true |  sudo debconf-set-selections
                sudo apt-get install oracle-java7-installer -qq -y
             
                # Install sbt
                wget http://dl.bintray.com/sbt/debian/sbt-0.13.7.deb
                sudo dpkg -i sbt-0.13.7.deb
                sudo apt-get update
                
                # Install EB CLI
                sudo add-apt-repository ppa:fkrull/deadsnakes -y
                sudo apt-get update
                sudo apt-get install python3.4
                wget https://bootstrap.pypa.io/get-pip.py
                sudo python get-pip.py
                sudo pip install awsebcli
        - script:
            name: Prepare Docker
            code: |-
                docker login --username="$DOCKER_USERNAME" --password="$DOCKER_PASSWORD" --email="$DOCKER_EMAIL"
        - script:
            name: sbt clean compile dockerBuildAndPush
            code: |-
                sbt clean compile dockerBuildAndPush
